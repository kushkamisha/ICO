<!doctype>
<html>
<head>
    <title>Confirm queries</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
</head>
<body>
    <div class="table-block">
        <table id="datatable-checkbox" role="grid" aria-describedby="datatable-checkbox_info" class="table">
            <thead>
                <tr>
                    <th class="ng-binding"><input id="select-all" type="checkbox" onclick="selectAll(this);"></th>
                    <th class="ng-binding">Date</th>
                    <th class="ng-binding">Transaction ID</th>
                    <th class="ng-binding">Amount (in foreign currency)</th>
                    <th class="ng-binding">Amount (in ETH)</th>
                    <th class="ng-binding">Tokens</th>
                    <th class="ng-binding">Status</th>
                </tr>
            </thead>
            <tbody name="tbody"></tbody>
        </table>
    </div>
    <center><button type="button" class="btn btn-success" onclick="sendSelected();">Submit</button></center>
    
    <script src="https://cdn.rawgit.com/ethereum/web3.js/develop/dist/web3.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script>
        function selectAll(obj) {
            $("input.select-default").each(function (index,item) {item.checked = obj.checked;});
        }
        function sendSelected() {
            for(var i = 0; i < document.getElementsByName("tbody").length; i++) {
                console.log(document.getElementsByName("tbody")[i].getElementsByClassName("td.input.checkbox").checked);
                if(document.getElementsByName("tbody")[i].getElementsByClassName("td.input.checkbox").checked) console.log("dd");
            }
            
        }
        
        $.getJSON("app/data/users.json", function(data) {
            for (var i = 0; i < data.length; i++) {
                if(data[i].transactions.length != 0) {
                    for (var j = 0; j < data[i].transactions.length; i++) {
                        if(data[i].transactions[j].currency != "eth") {
                            var status = "";
                            switch(data[i].transactions[j].status) {
                                case "new": status = "default"; break;
                                default:    status = "success"; break;
                            }
                            buildTR(
                                data[i].transactions[j].date,
                                data[i].transactions[j].url,
                                data[i].transactions[j].tx,
                                data[i].transactions[j].amount,
                                data[i].transactions[j].currency,
                                data[i].transactions[j].rateToEth,
                                data[i].transactions[j].tokens,
                                status
                            );
                        }
                    }
                }
            }
        });
        
        function buildTR(date, url, tx, amount, currency, rateToEth, tokens, status) {
        $("[name=tbody]").html($("[name=tbody]").html() + '<tr class="tr '+status+'">' +
                '<td class="table-hover"><input class="select-item select-'+status+' checkbox" type="checkbox"></td>' +
                '<td class="table-hover">'+date+'</td>' +
                '<td class="table-hover"><a href="'+url+'">'+tx+'</a></td>' +
                '<td class="table-hover">'+amount+' '+currency+'</td>' +
                '<td class="table-hover">'+amount*rateToEth+' ETH</td>' +
                '<td class="table-hover">'+tokens+' JTC</td>' +
                '<td class="table-hover"><button type="button" class="btn btn-'+status+'">'+status+'</button></td>' +
            '</tr>');
        }
    </script>
    <script src="app.js"></script>
</body>
</html>